import{State as o}from"./state.min.js";import{FILTERS as c,Styles as l}from"./constants.min.js";import{UI as i}from"./ui.min.js";import{Animations as r}from"./animations.min.js";import{checkArgs as p,clearElement as f,awaitFrame as u,handleOutsideClick as g,wait as w}from"./utils.min.js";import{Post as y}from"./post.min.js";import{updateNavbar as E}from"./header.min.js";import{clearPostsFeed as h}from"./post-helpers.min.js";export const DOM={},initIndex=()=>{DOM.appContainer=document.getElementById("network-app"),DOM.profileCard=document.getElementById("profile-card"),DOM.postsFeed=document.getElementById("posts-feed"),DOM.newPostContainer=document.getElementById("new-post-form-container"),DOM.newPostForm=document.getElementById("post-form"),DOM.newPostSubmitBtn=document.getElementById("submit-post"),DOM.newPostContent=document.getElementById("form-text"),DOM.followingButton=document.getElementById("following"),DOM.followersCount=document.getElementById("followers-count-value"),DOM.followingCount=document.getElementById("following-count-value"),DOM.profileHeader=document.getElementById("profile-header"),DOM.profileName=document.getElementById("profile-name"),DOM.profilePicture=document.getElementById("profile-picture"),DOM.messageContainer=document.getElementById("message-container"),DOM.profilePostsCount=document.getElementById("post-count-value"),DOM.modalContainer=document.getElementById("modal-container")};let m=new WeakMap;export const DOMUtils={addElMessage:async(e,t,{color:n="danger",position:a="afterend"}={})=>{if(!p({element:e,message:t},"DOMUtils.addElMessage"))return;DOMUtils.removeElMessage(e);const s=i.createEl({elType:"div",className:`message text-${n} mt-1`,textContent:t});e.insertAdjacentElement(a,s),await r.play(r.Names.fadeInExpand,s),await w(3e3),await r.play(r.Names.fadeOutShrink,s),s.remove()},removeElMessage:e=>{if(!e)return;const t=e.parentElement;if(!t)return;const n=t.querySelector(".message");n&&n.remove()},toggleDropdown:async e=>{if(!p(e,"DOMUtils.toggleDropdown"))return;const t=e.closest(".dropdown-wrapper");if(!t){console.warn("DOMUtils.toggleDropdown: Invalid dropdown wrapper.");return}const n=t.querySelector(".dropdown-menu");if(!n){console.warn("DOMUtils.toggleDropdown: Invalid dropdown menu.");return}const a=n.classList.contains("d-none"),s=async()=>{o.dropdownLock=!0,await r.play(r.Names.fadeOutSlideUp,n),n.classList.add("d-none")};a?(n.classList.remove("d-none"),await u(),await r.play(r.Names.fadeInSlideDown,n),o.dropdownLock=!1,g(t,s,"dropdown-item")):await s()},displayMainMessage:(e,t="danger")=>{if(!e){console.error("DOMUtils.displayMainMessage: Invalid message.");return}f(DOM.messageContainer),h(),o.showMessage=!0;const n=i.createMainMessage(e,t);DOM.messageContainer.appendChild(n),DOMUtils.updateLayout()},updateLayout:()=>{switch(o.showMessage?DOM.messageContainer?.classList.remove("hidden"):DOM.messageContainer?.classList.add("hidden"),o.showMessage=!1,o.currentFilter){case c.ALL:DOM.newPostContainer?.classList.remove("d-none"),DOM.profileCard?.classList.add("d-none");break;case c.FOLLOWING:DOM.newPostContainer?.classList.add("d-none"),DOM.profileCard?.classList.add("d-none");break;case c.PROFILE:DOM.newPostContainer?.classList.add("d-none"),DOM.profileCard?.classList.remove("d-none");break;default:DOM.newPostContainer?.classList.remove("d-none"),DOM.profileCard?.classList.add("d-none"),DOM.messageContainer?.classList.add("d-none"),console.log(`Invalid filter: ${o.currentFilter}`);break}},closeModal:()=>{f(DOM.modalContainer)},initInfiniteScroll:()=>{let e=document.getElementById("infinite-scroll-sentinel");e||(e=i.createEl({elType:"div",className:"infinite-scroll-sentinel",attributes:{id:"infinite-scroll-sentinel",style:"width: 100%;"}}),DOM.postsFeed.append(e)),o.scrollObserver&&o.scrollObserver.unobserve(e);const t=s=>{s[0].isIntersecting&&o.hasNextPost&&!o.postsLoading&&y.loadMorePosts()},n={root:null,rootMargin:"0px 0px 500px 0px",threshold:0},a=new IntersectionObserver(t,n);a.observe(e),o.scrollObserver=a},cleanObserver:()=>{o.scrollObserver&&(o.scrollObserver.disconnect(),o.scrollObserver=null)},toggleSentinelLoading:(e,t)=>{t&&t.classList.toggle("is-loading",e),o.postsLoading=e},refreshProfilePictures:()=>{const e=window.getDefaultProfilePicture();document.querySelectorAll(".nav-profile-picture, .post-profile-picture, .comment-profile-picture, .profile-picture").forEach(t=>{t.src.includes("default_profile")&&(t.src=e)})},handleTheme:()=>{const e=o.darkTheme;document.documentElement.classList.toggle("dark-mode",e),localStorage.setItem("isDark",e?"true":"false"),e?(DOM.navbar.className=l.DARK_MODE_NAV,DOM.themeIcon.className=l.DARK_MODE_TOGGLE):(DOM.navbar.className=l.WHITE_MODE_NAV,DOM.themeIcon.className=l.WHITE_MODE_TOGGLE),E(),DOMUtils.refreshProfilePictures()},toggleThemeListener:()=>{DOM.themeToggle.addEventListener("click",()=>{o.darkTheme=!o.darkTheme,DOMUtils.handleTheme()})},addSpinner:e=>{const t=i.spinner(),n=getComputedStyle(e);return["position","top","right","bottom","left","width","height","minWidth","maxWidth","margin","padding","flex","flexGrow","flexShrink","flexBasis","order","alignSelf","transform","zIndex"].forEach(d=>{t.style[d]=n[d]}),t.style.flexShrink="0",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",e.parentNode.replaceChild(t,e),m.set(t,e),t},removeSpinner:e=>{const t=m.get(e);t&&(e.parentNode.replaceChild(t,e),m.delete(e))}};