import{DOM as e,DOMUtils as m}from"./dom.min.js";import{State as n}from"./state.min.js";import{FILTERS as l}from"./constants.min.js";import{ProfileUtils as r,handleLogout as g}from"./profile.min.js";import{Post as u}from"./post.min.js";import{handleOutsideClick as c}from"./utils.min.js";async function i(t,o,s){o.preventDefault(),s.classList.add("disabled-link");try{t===l.PROFILE?await r.loadProfile(n.currentUserId):await u.loadPosts({filter:t})}finally{s.classList.remove("disabled-link")}}const v=()=>{e.loginBtn=document.getElementById("login"),e.logoutBtn=document.getElementById("logout"),e.registerBtn=document.getElementById("register"),e.navbarFollowingBtn=document.getElementById("following"),e.userMenu=document.getElementById("user-menu"),e.navbarProfilePicture=document.getElementById("nav-profile-picture"),e.navbarUsername=document.getElementById("nav-username"),e.mainNavLinks=document.getElementById("main-nav-links"),e.followingBtn=document.getElementById("following"),e.brandBtn=document.getElementById("brand"),e.allPostsBtn=document.getElementById("all"),e.themeToggle=document.getElementById("theme-toggle"),e.themeIcon=document.getElementById("theme-icon"),e.navbar=document.getElementById("navbar"),e.navbarCollapse=document.getElementById("responsive-nav-menu"),e.newPostRow=document.getElementById("new-post-row"),e.brandBtn?.addEventListener("click",t=>i(l.ALL,t,e.brandBtn)),e.allPostsBtn?.addEventListener("click",t=>i(l.ALL,t,e.allPostsBtn)),e.registerBtn?.addEventListener("click",t=>r.showAuthModal(e.registerBtn,"register",t)),e.loginBtn?.addEventListener("click",t=>r.showAuthModal(e.loginBtn,"login",t)),e.logoutBtn?.addEventListener("click",t=>g(t)),e.userMenu?.addEventListener("click",t=>i(l.PROFILE,t,e.navbarUsername)),e.followingBtn?.addEventListener("click",t=>i(l.FOLLOWING,t,e.followingBtn)),updateNavbar(),m.toggleThemeListener(),E()},E=()=>{if(!e.navbarCollapse)return;let t=null;const o=async()=>{const a=bootstrap.Collapse.getInstance(e.navbarCollapse);a&&a.hide()},s=()=>{c(e.navbarCollapse,o,"nav-link"),document.addEventListener("click",c),t=o},d=()=>{t&&(document.removeEventListener("click",t),t=null)};(()=>{let a;window.addEventListener("resize",()=>{clearTimeout(a),a=setTimeout(()=>{window.innerWidth>=1200&&e.navbarCollapse.classList.contains("show")&&(d(),e.navbarCollapse.style.transition="none",o(),e.navbarCollapse.style.transition="")},100)})})(),e.navbarCollapse.addEventListener("shown.bs.collapse",s),e.navbarCollapse.addEventListener("hidden.bs.collapse",d)};export const updateNavbar=()=>{if(!e.mainNavLinks)return;const t=n.userIsAuthenticated;e.mainNavLinks.classList.toggle("hidden",!t),e.userMenu.classList.toggle("hidden",!t),e.logoutBtn.classList.toggle("hidden",!t),e.loginBtn.classList.toggle("hidden",t),e.registerBtn.classList.toggle("hidden",t),e.newPostRow?.classList.toggle("hidden",!t),t&&(e.navbarUsername.textContent=n.currentUsername||"User",e.navbarProfilePicture.src=n.currentUserProfilePicture?n.currentUserProfilePicture:window.getDefaultProfilePicture(),e.allPostsBtn.classList.toggle("active",n.currentFilter===l.ALL),e.followingBtn.classList.toggle("active",n.currentFilter===l.FOLLOWING))},Header={init:v,updateNavbar};